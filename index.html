<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–∑–Ω–∞—é —Ç–≤–æ—é –¥—É—à—É –ª—É—á—à–µ üí´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .compact-music-player {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: none;
        }

        .compact-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .compact-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1em;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .compact-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .compact-info {
            flex-grow: 1;
            text-align: center;
        }

        .compact-title {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: bold;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .compact-track {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.7);
        }

        .compact-playlist {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-top: 10px;
            padding: 10px;
            display: none;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .compact-playlist-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .compact-playlist-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .compact-playlist-item:last-child {
            margin-bottom: 0;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            max-width: 700px;
            width: 100%;
            position: relative;
            min-height: 600px;
            margin: 20px auto;
            transition: all 0.3s ease;
        }

        .screen {
            display: none;
            animation: fadeInUp 0.8s ease;
        }

        .active {
            display: block;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.2em;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .question-text {
            font-size: 1.4em;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.6;
            min-height: 80px;
            text-align: center;
        }

        .input-section {
            margin: 30px 0;
        }

        .user-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1em;
            font-family: 'Arial', sans-serif;
            resize: vertical;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .user-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-back {
            background: linear-gradient(135deg, #a8a8a8 0%, #7a7a7a 100%);
            color: white;
            min-width: 150px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .ai-formulation {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin: 25px 0;
            text-align: left;
            display: none;
            animation: slideIn 0.5s ease;
        }

        .formulation-text {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .formulation-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 1em;
            min-width: 150px;
        }

        .progress {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .poem-container {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .poem-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            font-style: italic;
        }

        .poem-text {
            font-size: 1.3em;
            line-height: 1.8;
            font-style: italic;
            white-space: pre-line;
        }

        .music-player {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            width: 320px;
            z-index: 1000;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .music-player:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .player-title {
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .now-playing {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 0.9em;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .play-btn {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.3);
        }

        .progress-container {
            flex-grow: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .progress-bar-music {
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), rgba(102, 126, 234, 0.8));
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }

        .volume-slider {
            width: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            cursor: pointer;
        }

        .track-info {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .music-notice {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            margin-top: 5px;
            font-style: italic;
        }

        .playlist-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .playlist-btn:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .playlist {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 10px;
            margin-top: 10px;
            width: 280px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1001;
        }

        .playlist-item {
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .playlist-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .playlist-item.active {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            font-weight: bold;
        }

        .playlist-item .play-icon {
            font-size: 0.7em;
            opacity: 0;
        }

        .playlist-item.active .play-icon {
            opacity: 1;
        }

        .hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .heart {
            position: absolute;
            font-size: 24px;
            opacity: 0;
            animation: float 6s ease-in infinite;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes float {
            0% {
                transform: translateY(100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .typing-dots:after {
            content: '...';
            animation: typing 1.5s infinite;
        }

        @keyframes typing {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .character-count {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-top: -15px;
            margin-bottom: 15px;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .suggestion-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }

        .suggestion-btn {
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .suggestion-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 1920px) {
            .container {
                max-width: 650px;
                margin: 30px auto;
                padding: 35px;
            }
            
            .music-player {
                top: 15px;
                right: 15px;
                width: 300px;
            }
        }

        @media (max-width: 1600px) {
            .container {
                max-width: 600px;
                margin: 25px auto;
                padding: 30px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .question-text {
                font-size: 1.2em;
            }
        }

        @media (max-width: 1440px) {
            .container {
                max-width: 550px;
                margin: 20px auto;
                padding: 25px;
            }
            
            .music-player {
                width: 280px;
                padding: 12px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
            
            .question-text {
                font-size: 1.1em;
                min-height: 70px;
                margin-bottom: 25px;
            }
            
            .user-input {
                min-height: 100px;
                padding: 15px;
                font-size: 1em;
            }
            
            .btn {
                padding: 12px 25px;
                min-width: 180px;
                font-size: 1em;
            }
        }

        @media (max-width: 1366px) {
            .container {
                max-width: 500px;
                margin: 15px auto;
                padding: 20px;
            }
            
            .music-player {
                width: 260px;
                top: 10px;
                right: 10px;
            }
            
            h1 {
                font-size: 1.7em;
            }
            
            .question-text {
                font-size: 1em;
                min-height: 60px;
                margin-bottom: 20px;
            }
            
            .user-input {
                min-height: 90px;
                padding: 12px;
            }
        }

        @media (max-width: 1280px) {
            .container {
                max-width: 480px;
                margin: 10px auto;
                padding: 18px;
            }
            
            .music-player {
                width: 240px;
                padding: 10px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .btn {
                min-width: 160px;
                padding: 10px 20px;
            }
        }

        @media (max-width: 1200px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 450px;
                margin: 10px auto;
                padding: 15px;
                border-radius: 20px;
            }
            
            .music-player {
                position: relative;
                top: auto;
                right: auto;
                width: 100%;
                max-width: 400px;
                margin: 0 auto 20px auto;
                display: block !important;
            }
            
            .compact-music-player {
                display: none !important;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            
            .question-text {
                font-size: 0.95em;
                min-height: 55px;
                margin-bottom: 15px;
            }
            
            .user-input {
                min-height: 80px;
                padding: 10px;
                font-size: 0.9em;
            }
            
            .btn {
                min-width: 140px;
                padding: 8px 16px;
                font-size: 0.9em;
            }
            
            .btn-small {
                min-width: 120px;
                padding: 6px 12px;
                font-size: 0.85em;
            }
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 420px;
                padding: 15px;
            }
            
            .music-player {
                max-width: 380px;
            }
            
            h1 {
                font-size: 1.4em;
            }
            
            .question-text {
                font-size: 0.9em;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .container {
                max-width: 100%;
                margin: 0;
                padding: 15px;
                border-radius: 0;
                box-shadow: none;
            }
            
            .music-player {
                display: none !important;
            }
            
            .compact-music-player {
                display: block !important;
            }
            
            h1 {
                font-size: 1.4em;
                margin-bottom: 12px;
            }
            
            .question-text {
                font-size: 0.9em;
                min-height: 50px;
                margin-bottom: 15px;
            }
            
            .user-input {
                min-height: 70px;
                padding: 10px;
                font-size: 0.85em;
            }
            
            .btn {
                min-width: 100%;
                padding: 10px 15px;
                font-size: 0.9em;
            }
            
            .buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .suggestion-buttons {
                flex-direction: column;
            }
            
            .suggestion-btn {
                width: 100%;
                text-align: center;
                padding: 6px 12px;
                font-size: 0.85em;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-back {
                min-width: 100%;
            }
            
            .poem-text {
                font-size: 0.95em;
            }
            
            .ai-formulation {
                padding: 15px;
                margin: 15px 0;
            }
            
            .formulation-text {
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.3em;
            }
            
            .question-text {
                font-size: 0.85em;
                min-height: 45px;
            }
            
            .user-input {
                min-height: 60px;
                padding: 8px;
                font-size: 0.8em;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.85em;
            }
            
            .compact-music-player {
                padding: 8px 10px;
            }
            
            .compact-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9em;
            }
            
            .compact-title {
                font-size: 0.8em;
            }
            
            .compact-track {
                font-size: 0.65em;
            }
            
            .poem-container {
                padding: 20px;
                margin: 20px 0;
            }
            
            .poem-title {
                font-size: 1.4em;
            }
            
            .poem-text {
                font-size: 0.9em;
            }
        }

        @media (max-width: 360px) {
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.2em;
            }
            
            .question-text {
                font-size: 0.8em;
            }
            
            .user-input {
                min-height: 50px;
                padding: 6px;
                font-size: 0.75em;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.8em;
            }
            
            .compact-music-player {
                padding: 6px 8px;
            }
        }

        @media (min-height: 1000px) and (min-width: 1200px) {
            .container {
                min-height: 700px;
                margin: 50px auto;
            }
            
            .user-input {
                min-height: 150px;
            }
        }

        @media (min-width: 2000px) {
            .container {
                max-width: 800px;
                margin: 50px auto;
                padding: 50px;
            }
            
            h1 {
                font-size: 2.5em;
                margin-bottom: 30px;
            }
            
            .question-text {
                font-size: 1.6em;
                min-height: 100px;
                margin-bottom: 40px;
            }
            
            .user-input {
                min-height: 150px;
                padding: 25px;
                font-size: 1.2em;
            }
            
            .btn {
                padding: 20px 40px;
                min-width: 250px;
                font-size: 1.2em;
            }
            
            .music-player {
                width: 400px;
                padding: 25px;
                top: 30px;
                right: 30px;
            }
        }

        @media (hover: none) and (pointer: coarse) {
            .btn:hover, .suggestion-btn:hover, .control-btn:hover, .compact-btn:hover {
                transform: none;
            }
            
            .btn:active, .suggestion-btn:active, .control-btn:active, .compact-btn:active {
                transform: scale(0.95);
            }
        }
    </style>
</head>
<body>
    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–ª–µ–µ—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <div class="compact-music-player" id="compactPlayer">
        <div class="compact-controls">
            <button class="compact-btn" onclick="togglePlay()" id="compactPlayBtn">‚ñ∂</button>
            <div class="compact-info">
                <div class="compact-title" id="compactTitle">–ù–∞–∂–º–∏ ‚ñ∂</div>
                <div class="compact-track" id="compactTrack">1/4</div>
            </div>
            <button class="compact-btn" onclick="toggleCompactPlaylist()">üìã</button>
        </div>
        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç -->
        <div class="compact-playlist" id="compactPlaylist">
            <div class="compact-playlist-item" onclick="playTrack(0)">
                <span>‚ñ∂</span>
                <span>–ù–∞—à–∞ –∂–∏–∑–Ω—å - 2hug</span>
            </div>
            <div class="compact-playlist-item" onclick="playTrack(1)">
                <span>‚ñ∂</span>
                <span>–¢—ã —Ç–∞... - –ë–∞—Å—Ç–∞</span>
            </div>
            <div class="compact-playlist-item" onclick="playTrack(2)">
                <span>‚ñ∂</span>
                <span>–ü—Ä–∏–≤–µ—Ç - MATRANG, –ë–∞—Å—Ç–∞</span>
            </div>
            <div class="compact-playlist-item" onclick="playTrack(3)">
                <span>‚ñ∂</span>
                <span>–ë–æ–π—Å–±—ç–Ω–¥ - PHARAON, Ca$$xttx</span>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ–ø—Ä–æ—Å–Ω–∏–∫–∞ -->
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
        <div class="screen active" id="screen-welcome">
            <h1>üíñ –†–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ –æ —Å–µ–±–µ</h1>
            <p class="question-text">
                –≠—Ç–æ—Ç –æ–ø—Ä–æ—Å–Ω–∏–∫ –æ—Å–æ–±–µ–Ω–Ω—ã–π - –∑–¥–µ—Å—å –Ω–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!<br>
                –ü–∏—à–∏ –≤—Å—ë, —á—Ç–æ –ø—Ä–∏–¥—ë—Ç –≤ –≥–æ–ª–æ–≤—É, –∞ —è –ø–æ–º–æ–≥—É –∫—Ä–∞—Å–∏–≤–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –º—ã—Å–ª–∏.<br>
                –í –∫–æ–Ω—Ü–µ —Ç–µ–±—è –∂–¥—ë—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ! ‚ú®
            </p>
            <div class="buttons">
                <button class="btn btn-primary" onclick="startQuestions()">–ù–∞—á–∞—Ç—å –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä üí´</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ -->
        <div id="questions-container"></div>

        <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div class="screen" id="screen-final">
            <h1>–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ—Å—Ç—å! üíñ</h1>
            <div class="poem-container" id="finalPoem">
                <!-- –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ -->
            </div>
            <p class="question-text">–¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –ø–æ–º–æ–≥–ª–∏ –º–Ω–µ –ø–æ–Ω—è—Ç—å —Ç–µ–±—è –≥–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ! ‚ú®</p>
            <div class="buttons">
                <button class="btn btn-success" onclick="restartQuiz()">üîÑ –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</button>
            </div>
        </div>

        <div class="hearts-container" id="heartsContainer"></div>
    </div>

    <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø–ª–µ–µ—Ä –¥–ª—è –ü–ö -->
    <div class="music-player" id="musicPlayer">
        <div class="player-header">
            <div class="player-title">üéµ –ù–∞—à–∞ –º—É–∑—ã–∫–∞</div>
            <button class="playlist-btn" onclick="togglePlaylist()">üìã –ü–ª–µ–π–ª–∏—Å—Ç</button>
        </div>
        <div class="now-playing" id="nowPlaying">–ù–∞–∂–º–∏ ‚ñ∂ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</div>
        <div class="player-controls">
            <button class="control-btn" onclick="previousTrack()">‚èÆ</button>
            <button class="control-btn play-btn" onclick="togglePlay()" id="playBtn">‚ñ∂</button>
            <button class="control-btn" onclick="nextTrack()">‚è≠</button>
        </div>
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar-music" id="musicProgress"></div>
        </div>
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>
        <div class="volume-container">
            <span style="color: rgba(255,255,255,0.8);">üîä</span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" oninput="setVolume(this.value)">
        </div>
        <div class="track-info" id="trackInfo">1/4</div>
        <div class="music-notice">–ú—É–∑—ã–∫–∞ –¥–ª—è —Ç–≤–æ–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è üíñ</div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π –ø–ª–µ–π–ª–∏—Å—Ç -->
        <div class="playlist" id="playlist">
            <div class="playlist-item" onclick="playTrack(0)">
                <span class="play-icon">‚ñ∂</span>
                <span>–ù–∞—à–∞ –∂–∏–∑–Ω—å - 2hug</span>
            </div>
            <div class="playlist-item" onclick="playTrack(1)">
                <span class="play-icon">‚ñ∂</span>
                <span>–¢—ã —Ç–∞... - –ë–∞—Å—Ç–∞</span>
            </div>
            <div class="playlist-item" onclick="playTrack(2)">
                <span class="play-icon">‚ñ∂</span>
                <span>–ü—Ä–∏–≤–µ—Ç - MATRANG, –ë–∞—Å—Ç–∞</span>
            </div>
            <div class="playlist-item" onclick="playTrack(3)">
                <span class="play-icon">‚ñ∂</span>
                <span>–ë–æ–π—Å–±—ç–Ω–¥ - PHARAON, Ca$$xttx</span>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
const BOT_TOKEN = '8519621124:AAEtDBYSAeNW16UQiAGy0epAwwt989v9Tzs';
const CHAT_ID = '1490495592';
const JSONBIN_ID = '690bda1cae596e708f473589';
const JSONBIN_API_KEY = '$2a$10$nFkbrwHZpy3T9KrGUS6RxecAFiNTyKuGe.DZjFqoWYEUcbGS27YRC';

// ==================== AI –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
const HUGGING_FACE_API_KEY = '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';

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let userAnswers = {};
        let userOriginalTexts = {};
        let currentQuestion = 1;
        let questions = [];
        let audio, isPlaying = false, currentTrack = 0, updateInterval;
        let lastUpdateId = 0;
        let isSeeking = false;
        let audioInitialized = false;

        // –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏
        const tracks = [
            {
                name: "–ù–∞—à–∞ –∂–∏–∑–Ω—å - 2hug",
                url: "https://github.com/staralex197/romantic-questionnaire/raw/refs/heads/main/Music/2hug_-_Nasha_zhizn_79029104.mp3",
                duration: "3:11"
            },
            {
                name: "–¢—ã —Ç–∞... - –ë–∞—Å—Ç–∞",
                url: "https://github.com/staralex197/romantic-questionnaire/raw/refs/heads/main/Music/Basta_-_Ty_ta_61892966.mp3",
                duration: "3:56"
            },
            {
                name: "–ü—Ä–∏–≤–µ—Ç - MATRANG, –ë–∞—Å—Ç–∞",
                url: "https://github.com/staralex197/romantic-questionnaire/raw/refs/heads/main/Music/MATRANG_-_Privet_64870751.mp3",
                duration: "3:13"
            },
            {
                name: "–ë–æ–π—Å–±—ç–Ω–¥ - PHARAON, Ca$$xttx",
                url: "https://github.com/staralex197/romantic-questionnaire/raw/refs/heads/main/Music/PHARAOH_Caxttx_-_Bojjsbjend_64493563.mp3",
                duration: "2:58"
            }
        ];

        // ==================== AI –§–£–ù–ö–¶–ò–ò ====================
        async function queryHuggingFace(prompt) {
            try {
                const response = await fetch(HF_API_URL, {
                    headers: {
                        'Authorization': `Bearer ${HUGGING_FACE_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    method: 'POST',
                    body: JSON.stringify({
                        inputs: prompt,
                        parameters: {
                            max_new_tokens: 100,
                            temperature: 0.7,
                            do_sample: true
                        }
                    }),
                });
                
                const result = await response.json();
                
                if (result.error) {
                    console.error('Hugging Face error:', result.error);
                    return null;
                }
                
                return result[0]?.generated_text || null;
            } catch (error) {
                console.error('Hugging Face API error:', error);
                return null;
            }
        }

        async function generateAIFormulation(questionNum, userText) {
            const question = questions[questionNum - 1];
            
            const prompt = `–ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –∫—Ä–∞—Å–∏–≤–æ –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–º—ã—Å–ª. –¢–µ–∫—Å—Ç: "${userText}". –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞: "${question.text}". –ö—Ä–∞—Å–∏–≤–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:`;
            
            const aiResponse = await queryHuggingFace(prompt);
            
            if (aiResponse && aiResponse !== userText) {
                return aiResponse.replace(prompt, '').trim();
            }
            
            return generateSmartFormulation(questionNum, userText);
        }

        async function generateAISuggestions(questionText) {
            const prompt = `–ü—Ä–∏–¥—É–º–∞–π 4 –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø–æ–¥—Å–∫–∞–∑–∫–∏-–æ—Ç–≤–µ—Ç–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞: "${questionText}". –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏ –∏ –ø–æ–º–æ–≥–∞—Ç—å —á–µ–ª–æ–≤–µ–∫—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å. –§–æ—Ä–º–∞—Ç: –ø–æ–¥—Å–∫–∞–∑–∫–∞1, –ø–æ–¥—Å–∫–∞–∑–∫–∞2, –ø–æ–¥—Å–∫–∞–∑–∫–∞3, –ø–æ–¥—Å–∫–∞–∑–∫–∞4`;
            
            const aiResponse = await queryHuggingFace(prompt);
            
            if (aiResponse) {
                const suggestions = aiResponse.split(',').map(s => s.trim()).filter(s => s.length > 0);
                return suggestions.slice(0, 4);
            }
            
            return ["–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–¥—Ü–∞", "–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç", "–ß—É–≤—Å—Ç–≤–∞ –∏ —ç–º–æ—Ü–∏–∏", "–ú–µ—á—Ç—ã –∏ –Ω–∞–¥–µ–∂–¥—ã"];
        }

        async function generateAIPoem(answers) {
            let answersText = '';
            for (let i = 1; i <= questions.length; i++) {
                if (answers[i]) {
                    answersText += `–ù–∞ –≤–æ–ø—Ä–æ—Å "${questions[i-1].text}" –æ—Ç–≤–µ—Ç: ${answers[i].formulated}\n`;
                }
            }
            
            const prompt = `–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –ª–∏—Ä–∏—á–µ—Å–∫–æ–µ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤. –°—Ç–∏–ª—å: —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π, –¥—É—à–µ–≤–Ω—ã–π. –û—Ç–≤–µ—Ç—ã:\n${answersText}\n\n–°—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ:`;
            
            const aiResponse = await queryHuggingFace(prompt);
            
            if (aiResponse) {
                return {
                    title: "–¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è üí´",
                    text: aiResponse.replace(prompt, '').trim()
                };
            }
            
            return createPoemFromAnswers();
        }

        // ==================== JSONBIN –§–£–ù–ö–¶–ò–ò ====================
        async function loadQuestions() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ JSONBin...');
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ –í–æ–ø—Ä–æ—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.record.questions);
                return data.record.questions || getDefaultQuestions();
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:', error);
                return getDefaultQuestions();
            }
        }

        async function saveQuestions(newQuestions) {
            try {
                console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ JSONBin...');
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify({
                        questions: newQuestions,
                        last_updated: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ –í–æ–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', data);
                return true;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤:', error);
                return false;
            }
        }

        function getDefaultQuestions() {
            return [
                {
                    id: 1,
                    text: "–û–ø–∏—à–∏, –≤ —á—ë–º —Ç–≤–æ—è —Å–∞–º–∞—è —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞? –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –æ—Å–æ–±–µ–Ω–Ω–æ–π?",
                    theme: "–¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å üåü",
                    suggestions: ["–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–ó–∞–±–æ—Ç–∞", "–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å"]
                },
                {
                    id: 2,
                    text: "–ö–∞–∫–∞—è —É —Ç–µ–±—è —Å–∞–º–∞—è –∑–∞–≤–µ—Ç–Ω–∞—è –º–µ—á—Ç–∞? –û —á—ë–º —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä—É–µ—à—å?",
                    theme: "–¢–≤–æ–∏ –º–µ—á—Ç—ã üöÄ",
                    suggestions: ["–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", "–°–µ–º—å—è", "–°–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è", "–ü–æ–º–æ—â—å –¥—Ä—É–≥–∏–º"]
                },
                {
                    id: 3,
                    text: "–ß–µ–≥–æ —Ç—ã –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –±–æ–∏—à—å—Å—è –≤ –∂–∏–∑–Ω–∏? –ö–∞–∫–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Ç–µ–±–µ —Ç—è–∂–µ–ª–µ–µ –≤—Å–µ–≥–æ –¥–∞—é—Ç—Å—è?",
                    theme: "–°—Ç—Ä–∞—Ö–∏ –∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ üåßÔ∏è",
                    suggestions: ["–ü–æ—Ç–µ—Ä—è –±–ª–∏–∑–∫–∏—Ö", "–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å", "–ß—É–∂–æ–µ –º–Ω–µ–Ω–∏–µ", "–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π"]
                },
                {
                    id: 4,
                    text: "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è –∑–Ω–∞—á–∏—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è –ª—é–±–æ–≤—å? –ö–∞–∫–∏–º —Ç—ã –≤–∏–¥–∏—à—å –∏–¥–µ–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è?",
                    theme: "–õ—é–±–æ–≤—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è üíû",
                    suggestions: ["–ü–æ–¥–¥–µ—Ä–∂–∫–∞", "–î–æ–≤–µ—Ä–∏–µ", "–°–æ–≤–º–µ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç", "–î—Ä—É–∂–±–∞"]
                },
                {
                    id: 5,
                    text: "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —Å—á–∞—Å—Ç–ª–∏–≤–æ–π? –ö–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –¥–∞—Ä—è—Ç —Ç–µ–±–µ —Ä–∞–¥–æ—Å—Ç—å?",
                    theme: "–°—á–∞—Å—Ç—å–µ –≤ –º–µ–ª–æ—á–∞—Ö üå∏",
                    suggestions: ["–î—Ä—É–∑—å—è", "–ü—Ä–∏—Ä–æ–¥–∞", "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ", "–£—Å–ø–µ—Ö–∏"]
                },
                {
                    id: 6,
                    text: "–ö–∞–∫–∏–º —Ç—ã –≤–∏–¥–∏—à—å —Å–≤–æ—ë –±—É–¥—É—â–µ–µ? –ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —É—Å–ø–µ—Ç—å –≤ –∂–∏–∑–Ω–∏?",
                    theme: "–ë—É–¥—É—â–µ–µ –∏ –Ω–∞–¥–µ–∂–¥—ã üåÖ",
                    suggestions: ["–ö–∞—Ä—å–µ—Ä–∞", "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è", "–°–µ–º–µ–π–Ω–æ–µ —Å—á–∞—Å—Ç—å–µ", "–ù–∞—Å–ª–µ–¥–∏–µ"]
                },
                {
                    id: 7,
                    text: "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è —Å–∞–º–æ–µ —Ü–µ–Ω–Ω–æ–µ –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö? –ß—Ç–æ –±—ã —Ç—ã —Ö–æ—Ç–µ–ª–∞ –≤ –Ω–∏—Ö —É–ª—É—á—à–∏—Ç—å?",
                    theme: "–ù–∞—à–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è üíë",
                    suggestions: ["–ü–æ–Ω–∏–º–∞–Ω–∏–µ", "–û–±—â–∏–µ –º–æ–º–µ–Ω—Ç—ã", "–ü–æ–¥–¥–µ—Ä–∂–∫–∞", "–í—Ä–µ–º—è –≤–º–µ—Å—Ç–µ"]
                }
            ];
        }

        // ==================== TELEGRAM –ë–û–¢ –§–£–ù–ö–¶–ò–ò ====================
        async function sendTelegramMessage(chatId, text, parse_mode = 'Markdown') {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: text,
                        parse_mode: parse_mode
                    })
                });
                const result = await response.json();
                
                if (!result.ok) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', result);
                }
                
                return result;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', error);
                return { ok: false, error: error.message };
            }
        }

        async function checkBotMessages() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastUpdateId + 1}&timeout=5`);
                const data = await response.json();
                
                if (data.ok && data.result.length > 0) {
                    for (const update of data.result) {
                        if (update.update_id <= lastUpdateId) continue;
                        
                        await processBotUpdate(update);
                        lastUpdateId = update.update_id;
                    }
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
            }
        }

        async function processBotUpdate(update) {
            const message = update.message;
            if (!message || !message.text) return;
            
            const chatId = message.chat.id;
            const text = message.text.trim();
            
            if (chatId == CHAT_ID) {
                await handleAdminCommand(text, chatId);
            }
        }

        async function handleAdminCommand(command, chatId) {
            console.log('üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã:', command);
            const parts = command.split(' ');
            const mainCommand = parts[0];
            
            if (mainCommand.startsWith('/edit_')) {
                const questionId = mainCommand.replace('/edit_', '');
                await editQuestion(chatId, questionId, parts.slice(1).join(' '));
                return;
            }
            
            if (mainCommand.startsWith('/delete_')) {
                const questionId = mainCommand.replace('/delete_', '');
                await deleteQuestion(chatId, questionId);
                return;
            }
            
            switch(mainCommand) {
                case '/start':
                    await sendAdminWelcome(chatId);
                    break;
                case '/questions':
                    await showQuestionsList(chatId);
                    break;
                case '/add':
                    await addQuestion(chatId, parts.slice(1).join(' '));
                    break;
                case '/edit':
                    await editQuestion(chatId, parts[1], parts.slice(2).join(' '));
                    break;
                case '/delete':
                    await deleteQuestion(chatId, parts[1]);
                    break;
                case '/refresh':
                    await refreshQuestions(chatId);
                    break;
                case '/help':
                    await showHelp(chatId);
                    break;
                default:
                    if (command.startsWith('/edit') || command.startsWith('/delete')) {
                        await sendTelegramMessage(chatId, '‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Å–ø–∏—Å–∫–∞ /help');
                    } else {
                        await sendTelegramMessage(chatId, '‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.');
                    }
            }
        }

        async function sendAdminWelcome(chatId) {
            const message = `ü§ñ *–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞–º–∏*

*–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/questions - —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
/add - –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
/edit - –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å
/delete - —É–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
/refresh - –æ–±–Ω–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã
/help - —Å–ø—Ä–∞–≤–∫–∞

*–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞:*
/add –¢–µ–º–∞|–í–æ–ø—Ä–æ—Å|–ø–æ–¥—Å–∫–∞–∑–∫–∞1,–ø–æ–¥—Å–∫–∞–∑–∫–∞2

*–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞:*
/edit 1 –ù–æ–≤–∞—è —Ç–µ–º–∞|–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å

*–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤ —Å–ø–∏—Å–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤*`;
            await sendTelegramMessage(chatId, message);
        }

        async function showHelp(chatId) {
            const message = `üìñ *–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º*

*/questions* - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
*/add —Ç–µ–º–∞|–≤–æ–ø—Ä–æ—Å|–ø–æ–¥—Å–∫–∞–∑–∫–∏* - –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
*/edit –Ω–æ–º–µ—Ä –Ω–æ–≤–∞—è_—Ç–µ–º–∞|–Ω–æ–≤—ã–π_–≤–æ–ø—Ä–æ—Å* - –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å
*/delete –Ω–æ–º–µ—Ä* - —É–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
*/refresh* - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã

*–ü—Ä–∏–º–µ—Ä—ã:*
/add üåü –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å|–û–ø–∏—à–∏ —Å–≤–æ—é —Å–∏–ª—É?|–°–∏–ª–∞,–ú—É–¥—Ä–æ—Å—Ç—å,–ö—Ä–∞—Å–æ—Ç–∞
/edit 1 üí´ –°–∏–ª–∞|–í —á—ë–º —Ç–≤–æ—è —Å–∏–ª–∞?|–°–∏–ª–∞,–ú—É–¥—Ä–æ—Å—Ç—å
/delete 2

*–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤ —Å–ø–∏—Å–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤:* /questions`;
            await sendTelegramMessage(chatId, message);
        }

        async function showQuestionsList(chatId) {
            if (!questions || questions.length === 0) {
                await sendTelegramMessage(chatId, 'üìù –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—É—Å—Ç');
                return;
            }
            
            let message = 'üìù *–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤:*\n\n';
            questions.forEach((q, index) => {
                message += `*${q.id}. ${q.theme}*\n`;
                message += `–í–æ–ø—Ä–æ—Å: ${q.text}\n`;
                if (q.suggestions && q.suggestions.length > 0) {
                    message += `–ü–æ–¥—Å–∫–∞–∑–∫–∏: ${q.suggestions.join(', ')}\n`;
                }
                message += `–ö–æ–º–∞–Ω–¥—ã: /edit_${q.id} /delete_${q.id}\n\n`;
            });
            message += `–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${questions.length}\n`;
            message += '–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å: /add —Ç–µ–º–∞|–≤–æ–ø—Ä–æ—Å|–ø–æ–¥—Å–∫–∞–∑–∫–∏';
            
            await sendTelegramMessage(chatId, message);
        }

        async function addQuestion(chatId, text) {
            if (!text) {
                await sendTelegramMessage(chatId, '‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /add —Ç–µ–º–∞|–≤–æ–ø—Ä–æ—Å|–ø–æ–¥—Å–∫–∞–∑–∫–∞1,–ø–æ–¥—Å–∫–∞–∑–∫–∞2\n\n–ü—Ä–∏–º–µ—Ä: /add üåü –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å|–û–ø–∏—à–∏ —Å–≤–æ—é —Å–∏–ª—É?|–°–∏–ª–∞,–ú—É–¥—Ä–æ—Å—Ç—å');
                return;
            }
            
            const parts = text.split('|');
            if (parts.length < 2) {
                await sendTelegramMessage(chatId, '‚ùå –§–æ—Ä–º–∞—Ç: —Ç–µ–º–∞|–≤–æ–ø—Ä–æ—Å|–ø–æ–¥—Å–∫–∞–∑–∫–∏\n\n–ü—Ä–∏–º–µ—Ä: /add üåü –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å|–û–ø–∏—à–∏ —Å–≤–æ—é —Å–∏–ª—É?|–°–∏–ª–∞,–ú—É–¥—Ä–æ—Å—Ç—å');
                return;
            }
            
            const newQuestion = {
                id: questions.length > 0 ? Math.max(...questions.map(q => q.id)) + 1 : 1,
                theme: parts[0].trim(),
                text: parts[1].trim() + (parts[1].trim().endsWith('?') ? '' : '?'),
                suggestions: parts[2] ? parts[2].split(',').map(s => s.trim()) : []
            };
            
            // –ï—Å–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ AI
            if (!parts[2]) {
                const aiSuggestions = await generateAISuggestions(newQuestion.text);
                newQuestion.suggestions = aiSuggestions;
            }
            
            questions.push(newQuestion);
            const success = await saveQuestions(questions);
            
            if (success) {
                await sendTelegramMessage(chatId, `‚úÖ *–í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω!*\n\n*${newQuestion.theme}*\n${newQuestion.text}\n\n–ü–æ–¥—Å–∫–∞–∑–∫–∏: ${newQuestion.suggestions.join(', ') || '–Ω–µ—Ç'}`);
                generateQuestionScreens();
            } else {
                await sendTelegramMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞');
                questions.pop();
            }
        }

        async function editQuestion(chatId, questionId, text) {
            if (!questionId || !text) {
                await sendTelegramMessage(chatId, '‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /edit –Ω–æ–º–µ—Ä_–≤–æ–ø—Ä–æ—Å–∞ –Ω–æ–≤–∞—è_—Ç–µ–º–∞|–Ω–æ–≤—ã–π_–≤–æ–ø—Ä–æ—Å\n\n–ü—Ä–∏–º–µ—Ä: /edit 1 üí´ –°–∏–ª–∞|–í —á—ë–º —Ç–≤–æ—è —Å–∏–ª–∞?');
                return;
            }
            
            const id = parseInt(questionId);
            const questionIndex = questions.findIndex(q => q.id === id);
            
            if (questionIndex === -1) {
                await sendTelegramMessage(chatId, `‚ùå –í–æ–ø—Ä–æ—Å —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return;
            }
            
            const parts = text.split('|');
            const oldQuestion = {...questions[questionIndex]};
            
            questions[questionIndex].theme = parts[0].trim();
            questions[questionIndex].text = parts[1].trim() + (parts[1].trim().endsWith('?') ? '' : '?');
            
            if (parts[2]) {
                questions[questionIndex].suggestions = parts[2].split(',').map(s => s.trim());
            }
            
            const success = await saveQuestions(questions);
            
            if (success) {
                await sendTelegramMessage(chatId, `‚úÖ *–í–æ–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω!*\n\n*–ë—ã–ª–æ:*\n${oldQuestion.theme}\n${oldQuestion.text}\n\n*–°—Ç–∞–ª–æ:*\n${questions[questionIndex].theme}\n${questions[questionIndex].text}`);
                generateQuestionScreens();
            } else {
                await sendTelegramMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞');
                questions[questionIndex] = oldQuestion;
            }
        }

        async function deleteQuestion(chatId, questionId) {
            if (!questionId) {
                await sendTelegramMessage(chatId, '‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /delete –Ω–æ–º–µ—Ä_–≤–æ–ø—Ä–æ—Å–∞\n\n–ü—Ä–∏–º–µ—Ä: /delete 2');
                return;
            }
            
            const id = parseInt(questionId);
            const questionIndex = questions.findIndex(q => q.id === id);
            
            if (questionIndex === -1) {
                await sendTelegramMessage(chatId, `‚ùå –í–æ–ø—Ä–æ—Å —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return;
            }
            
            const deletedQuestion = questions.splice(questionIndex, 1)[0];
            const success = await saveQuestions(questions);
            
            if (success) {
                await sendTelegramMessage(chatId, `‚úÖ *–í–æ–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω!*\n\n*${deletedQuestion.theme}*\n${deletedQuestion.text}`);
                generateQuestionScreens();
            } else {
                await sendTelegramMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞');
                questions.splice(questionIndex, 0, deletedQuestion);
            }
        }

        async function refreshQuestions(chatId) {
            const newQuestions = await loadQuestions();
            questions = newQuestions;
            generateQuestionScreens();
            await sendTelegramMessage(chatId, `‚úÖ –í–æ–ø—Ä–æ—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã! –í—Å–µ–≥–æ: ${questions.length}`);
        }

        // ==================== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –û–ü–†–û–°–ù–ò–ö–ê ====================
        function generateQuestionScreens() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            questions.forEach((question, index) => {
                const questionNumber = index + 1;
                const progressWidth = (questionNumber / questions.length) * 100;
                
                const screenHTML = `
                <div class="screen" id="screen${questionNumber}">
                    <h1>${question.theme}</h1>
                    <p class="question-text">${question.text}</p>
                    
                    ${question.suggestions && question.suggestions.length > 0 ? `
                    <div class="suggestion-buttons">
                        ${question.suggestions.map(suggestion => 
                            `<button class="suggestion-btn" onclick="addSuggestion(${questionNumber}, '${suggestion.replace(/'/g, "\\'")}')">${suggestion}</button>`
                        ).join('')}
                    </div>
                    ` : ''}
                    
                    <div class="input-section">
                        <div class="character-count" id="count${questionNumber}">0/500 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <textarea class="user-input" id="input${questionNumber}" placeholder="–ù–∞–ø–∏—à–∏ –∑–¥–µ—Å—å –≤—Å—ë, —á—Ç–æ —Å—á–∏—Ç–∞–µ—à—å –≤–∞–∂–Ω—ã–º... üí≠" maxlength="500" oninput="updateCharacterCount(${questionNumber})"></textarea>
                        
                        <div class="buttons">
                            <button class="btn btn-primary" onclick="useMyWords(${questionNumber})">üíñ –ó–∞–ø–∏—Å–∞—Ç—å –º–æ–π –æ—Ç–≤–µ—Ç</button>
                            <button class="btn btn-secondary" onclick="aiFormulate(${questionNumber})">‚ú® –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞</button>
                        </div>
                    </div>
                    
                    <div class="ai-formulation" id="aiFormulation${questionNumber}">
                        <div class="formulation-text" id="formulationText${questionNumber}"></div>
                        <div class="formulation-actions">
                            <button class="btn btn-success btn-small" onclick="acceptFormulation(${questionNumber})">‚úÖ –ù—Ä–∞–≤–∏—Ç—Å—è</button>
                            <button class="btn btn-secondary btn-small" onclick="reformulate(${questionNumber})">üîÑ –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-primary btn-small" onclick="useMyWords(${questionNumber})">üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π —Ç–µ–∫—Å—Ç</button>
                        </div>
                    </div>
                    
                    <div class="progress">
                        <div class="progress-bar" style="width: ${progressWidth}%"></div>
                    </div>
                    
                    <div class="navigation-buttons">
                        <button class="btn btn-back" onclick="previousQuestion(${questionNumber})">‚Üê –ù–∞–∑–∞–¥</button>
                        <div></div>
                    </div>
                </div>
                `;
                
                container.innerHTML += screenHTML;
            });
        }

        function startQuestions() {
            if (questions.length === 0) {
                alert('–í–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                return;
            }
            nextScreen('screen1');
        }

        function nextScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            } else {
                console.error('–≠–∫—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω:', screenId);
            }
            
            createHearts();
        }

        function previousQuestion(currentQ) {
            if (currentQ > 1) {
                nextScreen('screen' + (currentQ - 1));
            } else {
                nextScreen('screen-welcome');
            }
        }

        function updateCharacterCount(questionNum) {
            const input = document.getElementById(`input${questionNum}`);
            const count = document.getElementById(`count${questionNum}`);
            if (input && count) {
                count.textContent = `${input.value.length}/500 —Å–∏–º–≤–æ–ª–æ–≤`;
            }
        }

        function addSuggestion(questionNum, text) {
            const input = document.getElementById(`input${questionNum}`);
            if (input) {
                if (input.value.trim() === '') {
                    input.value = text;
                } else {
                    let currentText = input.value.trim();
                    if (currentText.endsWith('.') || currentText.endsWith('!') || currentText.endsWith('?')) {
                        currentText = currentText.slice(0, -1);
                    }
                    input.value = currentText + '. ' + text;
                }
                updateCharacterCount(questionNum);
            }
        }

        function useMyWords(questionNum) {
            const input = document.getElementById(`input${questionNum}`);
            if (!input) return;
            
            const userText = input.value.trim();
            if (userText.length < 3) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ ü§ó');
                return;
            }
            
            userOriginalTexts[questionNum] = userText;
            userAnswers[questionNum] = {
                original: userText,
                formulated: userText,
                source: 'user'
            };
            
            moveToNextQuestion(questionNum);
        }

        async function aiFormulate(questionNum) {
            const input = document.getElementById(`input${questionNum}`);
            if (!input) return;
            
            const userText = input.value.trim();
            if (userText.length < 3) {
                alert('–ù–∞–ø–∏—à–∏ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É —Å–ª–æ–≤ üí≠');
                return;
            }
            
            userOriginalTexts[questionNum] = userText;
            const formulationDiv = document.getElementById(`aiFormulation${questionNum}`);
            const formulationText = document.getElementById(`formulationText${questionNum}`);
            
            if (formulationDiv && formulationText) {
                formulationText.innerHTML = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–∏ –º—ã—Å–ª–∏<span class="typing-dots"></span>';
                formulationDiv.style.display = 'block';
                
                setTimeout(async () => {
                    const formulatedText = await generateAIFormulation(questionNum, userText);
                    formulationText.innerHTML = formulatedText;
                    userAnswers[questionNum] = {
                        original: userText,
                        formulated: formulatedText,
                        source: 'ai'
                    };
                }, 1000);
            }
        }

        function generateSmartFormulation(questionNum, userText) {
            const questionIndex = questionNum - 1;
            if (questionIndex < 0 || questionIndex >= questions.length) {
                return `–Ø —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å: ${userText}`;
            }
            
            const question = questions[questionIndex];
            const questionTheme = question.theme.toLowerCase();
            
            const formulations = {
                "—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å": [
                    `–ú–æ—è —Å–∏–ª–∞ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ ${userText}`,
                    `–Ø –æ—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω—é –≤ —Å–µ–±–µ: ${userText}`,
                    `–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–µ–Ω—è –æ—Å–æ–±–µ–Ω–Ω–æ–π: ${userText}`,
                    `–ú–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —á–µ—Ä—Ç–∞ - ${userText}`,
                    `–Ø –≥–æ—Ä–∂—É—Å—å —Å–≤–æ–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é ${userText}`
                ],
                "–º–µ—á—Ç—ã": [
                    `–Ø –º–µ—á—Ç–∞—é –æ —Ç–æ–º, —á—Ç–æ–±—ã ${userText}`,
                    `–ú–æ–∏ —Å–∞–º—ã–µ —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω—ã–µ –∂–µ–ª–∞–Ω–∏—è: ${userText}`,
                    `–í —Å–≤–æ–∏—Ö —Ñ–∞–Ω—Ç–∞–∑–∏—è—Ö —è –≤–∏–∂—É: ${userText}`,
                    `–Ø —Å—Ç—Ä–µ–º–ª—é—Å—å –∫: ${userText}`,
                    `–ú–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å: ${userText}`
                ],
                "—Å—Ç—Ä–∞—Ö–∏": [
                    `–ú–µ–Ω—è –±–µ—Å–ø–æ–∫–æ–∏—Ç: ${userText}`,
                    `–Ø –ø–µ—Ä–µ–∂–∏–≤–∞—é –∏–∑-–∑–∞: ${userText}`,
                    `–¢—Ä—É–¥–Ω–æ—Å—Ç–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Å—å: ${userText}`,
                    `–ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —É –º–µ–Ω—è —Ç—Ä–µ–≤–æ–≥—É: ${userText}`,
                    `–ú–æ–∏ –æ–ø–∞—Å–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω—ã —Å: ${userText}`
                ],
                "–ª—é–±–æ–≤—å": [
                    `–î–ª—è –º–µ–Ω—è –ª—é–±–æ–≤—å - —ç—Ç–æ ${userText}`,
                    `–Ø –ø–æ–Ω–∏–º–∞—é –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–∞–∫: ${userText}`,
                    `–í –ª—é–±–≤–∏ —è —Ü–µ–Ω—é: ${userText}`,
                    `–ò–¥–µ–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –º–µ–Ω—è - –∫–æ–≥–¥–∞ ${userText}`,
                    `–°—É—Ç—å –ª—é–±–≤–∏ —è –≤–∏–∂—É –≤: ${userText}`
                ],
                "—Å—á–∞—Å—Ç—å–µ": [
                    `–°—á–∞—Å—Ç—å–µ –¥–ª—è –º–µ–Ω—è: ${userText}`,
                    `–Ø —á—É–≤—Å—Ç–≤—É—é —Ä–∞–¥–æ—Å—Ç—å, –∫–æ–≥–¥–∞ ${userText}`,
                    `–ß—Ç–æ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –º–µ–Ω—è —Å—á–∞—Å—Ç—å–µ–º: ${userText}`,
                    `–ú–æ–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–∞–¥–æ—Å—Ç–∏: ${userText}`,
                    `–Ø –Ω–∞—Ö–æ–∂—É —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –≤: ${userText}`
                ],
                "–±—É–¥—É—â–µ–µ": [
                    `–Ø –≤–∏–∂—É —Å–≤–æ—ë –±—É–¥—É—â–µ–µ —Ç–∞–∫–∏–º: ${userText}`,
                    `–ú–æ–∏ –ø–ª–∞–Ω—ã –∏ –Ω–∞–¥–µ–∂–¥—ã: ${userText}`,
                    `–ö —á–µ–º—É —è —Å—Ç—Ä–µ–º–ª—é—Å—å –≤ –∂–∏–∑–Ω–∏: ${userText}`,
                    `–í –±—É–¥—É—â–µ–º —è —Ö–æ—á—É: ${userText}`,
                    `–ú–æ–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏: ${userText}`
                ],
                "–æ—Ç–Ω–æ—à–µ–Ω–∏—è": [
                    `–í –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —è —Ü–µ–Ω—é: ${userText}`,
                    `–ß—Ç–æ –¥–ª—è –º–µ–Ω—è –≤–∞–∂–Ω–æ –≤ –Ω–∞—Å: ${userText}`,
                    `–û—Å–æ–±–µ–Ω–Ω–æ–µ –≤ –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö: ${userText}`,
                    `–Ø –¥–æ—Ä–æ–∂—É —Ç–µ–º, —á—Ç–æ ${userText}`,
                    `–ù–∞—à–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –º–µ–Ω—è - —ç—Ç–æ ${userText}`
                ]
            };

            let category = "—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å";
            for (const key in formulations) {
                if (questionTheme.includes(key)) {
                    category = key;
                    break;
                }
            }

            const options = formulations[category] || formulations["—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å"];
            return options[Math.floor(Math.random() * options.length)];
        }

        function acceptFormulation(questionNum) {
            moveToNextQuestion(questionNum);
        }

        async function reformulate(questionNum) {
            const userText = userOriginalTexts[questionNum];
            const formulationText = document.getElementById(`formulationText${questionNum}`);
            
            if (formulationText) {
                formulationText.innerHTML = '–ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É—é...<span class="typing-dots"></span>';
                setTimeout(async () => {
                    const newFormulation = await generateAIFormulation(questionNum, userText);
                    formulationText.innerHTML = newFormulation;
                    userAnswers[questionNum].formulated = newFormulation;
                }, 800);
            }
        }

        function moveToNextQuestion(currentQ) {
            const formulationDiv = document.getElementById(`aiFormulation${currentQ}`);
            if (formulationDiv) {
                formulationDiv.style.display = 'none';
            }
            
            if (currentQ < questions.length) {
                nextScreen('screen' + (currentQ + 1));
            } else {
                generateAndSendResults();
            }
        }

        async function generateAndSendResults() {
            const poem = await generateAIPoem(userAnswers);
            const finalPoem = document.getElementById('finalPoem');
            
            if (finalPoem) {
                finalPoem.innerHTML = `
                    <div class="poem-title">${poem.title}</div>
                    <div class="poem-text">${poem.text}</div>
                `;
            }
            
            nextScreen('screen-final');
            await sendResultsToTelegram(poem);
        }

        function createPoemFromAnswers() {
            const getAnswer = (num) => {
                const answer = userAnswers[num];
                if (!answer) return '—Ç–≤–æ—è –¥—É—à–∞ –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞';
                return answer.formulated || answer.original || '—Ç–≤–æ—è –¥—É—à–∞ –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞';
            };

            const strengths = getAnswer(1);
            const dreams = getAnswer(2);
            const fears = getAnswer(3);
            const love = getAnswer(4);
            const happiness = getAnswer(5);
            const future = getAnswer(6);
            const relationship = getAnswer(7);

            const poems = [
                {
                    title: "–¢–µ–±–µ, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π üí´",
                    text: `–¢–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: "${strengths}"\n–ò –≤ —ç—Ç–æ–º - –≤—Å—è —Ç–≤–æ—è —Å—É—Ç—å,\n–¢–≤–æ–∏ –º–µ—á—Ç—ã: "${dreams}"\n–ü—Ä–æ—Ç—è–≥–∏–≤–∞—è –≤ –±—É–¥—É—â–µ–µ –ø—É—Ç—å.\n\n–¢—ã –Ω–∞—Ö–æ–¥–∏—à—å —Å—á–∞—Å—Ç—å–µ –≤ "${happiness}"\n–ò –≤ —ç—Ç–æ–º —Ç–≤–æ—è –º—É–¥—Ä–æ—Å—Ç—å,\n–¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å –ª—é–±–æ–≤—å –∫–∞–∫ "${love}"\n–ò –≤ —ç—Ç–æ–º —Ç–≤–æ—è –≥–ª—É–±–∏–Ω–∞.\n\n–ü—É—Å—Ç—å —Å–±—É–¥—É—Ç—Å—è –≤—Å–µ –∂–µ–ª–∞–Ω—å—è,\n–ß—Ç–æ —Ç—ã –∑–∞–≥–∞–¥–∞–ª–∞ –≤ —Ç–∏—à–∏,\n–¢—ã - –ª—É—á—à–µ–µ –∏–∑ —Å–æ–∑–¥–∞–Ω–∏–π,\n–ò –Ω–µ—Ç –Ω–∞ —Å–≤–µ—Ç–µ –¥—É—à–∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–µ–π!`
                },
                {
                    title: "–û–¥–∞ —Ç–≤–æ–µ–π –¥—É—à–µ üå∏", 
                    text: `–í —Ç–≤–æ–∏—Ö —Å–ª–æ–≤–∞—Ö: "${strengths}"\n–Ø –≤–∏–∂—É —Å–≤–µ—Ç —Ç–≤–æ–µ–π –¥—É—à–∏,\n–ò –≤ –º–µ—á—Ç–∞—Ö: "${dreams}"\n–¢–≤–æ—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ "—á—Ç–æ –µ—Å–ª–∏".\n\n–¢—ã –≤–∏–¥–∏—à—å –±—É–¥—É—â–µ–µ: "${future}"\n–ò —Å—Ç—Ä–µ–º–∏—à—å—Å—è –∫ –Ω–µ–º—É —Å–º–µ–ª–æ,\n–í –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Ü–µ–Ω–∏—à—å: "${relationship}"\n–ò –≤ —ç—Ç–æ–º —Ç–≤–æ—è —Ç–µ–ø–ª–æ—Ç–∞.\n\n–ë—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤–∞, –º–æ—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è,\n–¢–≤–æ–∏ —Å–ª–æ–≤–∞ - –∫–∞–∫ —Å—Ç–∏—Ö–∏,\n–¢—ã - —Å–∞–º–∞—è —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–∞—è,\n–ò –Ω–µ—Ç –Ω–∞ —Å–≤–µ—Ç–µ –¥—Ä—É–≥–æ–π —Ç–∞–∫–æ–π!`
                }
            ];
            
            return poems[Math.floor(Math.random() * poems.length)];
        }

        async function sendResultsToTelegram(poem) {
            let message = `üí´ *–ù–û–í–´–ï –û–¢–í–ï–¢–´!*\n\n`;
            
            for (let i = 1; i <= questions.length; i++) {
                if (userAnswers[i]) {
                    const question = questions[i-1];
                    message += `*${question.theme}*\n`;
                    message += `üìù *–û—Ç–≤–µ—Ç:* ${userAnswers[i].original}\n`;
                    if (userAnswers[i].source === 'ai') {
                        message += `‚ú® *–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:* ${userAnswers[i].formulated}\n`;
                    }
                    message += `\n`;
                }
            }
            
            message += `üìú *–ü–ï–†–°–û–ù–ê–õ–¨–ù–û–ï –°–¢–ò–•–û–¢–í–û–†–ï–ù–ò–ï*\n`;
            message += `*${poem.title}*\n`;
            message += `\n${poem.text}\n\n`;
            message += `*–í—Ä–µ–º—è:* ${new Date().toLocaleString('ru-RU')}\n`;
            message += `*–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤:* ${questions.length}`;
            
            await sendTelegramMessage(CHAT_ID, message);
        }

        function createHearts() {
            const container = document.getElementById('heartsContainer');
            if (container) {
                container.innerHTML = '';
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart';
                        heart.innerHTML = 'üíñ';
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.animationDelay = Math.random() * 2 + 's';
                        container.appendChild(heart);
                    }, i * 400);
                }
            }
        }

        function restartQuiz() {
            userAnswers = {};
            userOriginalTexts = {};
            currentQuestion = 1;
            document.querySelectorAll('.user-input').forEach(input => input.value = '');
            document.querySelectorAll('.character-count').forEach(count => count.textContent = '0/500 —Å–∏–º–≤–æ–ª–æ–≤');
            document.querySelectorAll('.ai-formulation').forEach(form => form.style.display = 'none');
            nextScreen('screen-welcome');
        }

        // ==================== –ú–£–ó–´–ö–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function initializeAudio() {
            if (!audioInitialized) {
                audioInitialized = true;
                audio = new Audio();
                audio.volume = 0.5;
                
                audio.src = tracks[0].url;
                audio.load();
                
                document.getElementById('nowPlaying').textContent = tracks[0].name;
                document.getElementById('compactTitle').textContent = tracks[0].name;
                document.getElementById('trackInfo').textContent = `1/${tracks.length}`;
                document.getElementById('compactTrack').textContent = `1/${tracks.length}`;
                updatePlaylistHighlight();
            }
        }

        function loadAndPlayTrack(index) {
            if (!audioInitialized) {
                initializeAudio();
            }
            
            currentTrack = index;
            audio.src = tracks[index].url;
            document.getElementById('musicProgress').style.width = '0%';
            document.getElementById('currentTime').textContent = '0:00';
            
            audio.play().then(() => {
                isPlaying = true;
                document.getElementById('playBtn').textContent = '‚è∏';
                document.getElementById('compactPlayBtn').textContent = '‚è∏';
                document.getElementById('nowPlaying').textContent = tracks[index].name;
                document.getElementById('compactTitle').textContent = tracks[index].name;
                document.getElementById('trackInfo').textContent = `${currentTrack + 1}/${tracks.length}`;
                document.getElementById('compactTrack').textContent = `${currentTrack + 1}/${tracks.length}`;
                document.getElementById('duration').textContent = tracks[index].duration;
                updatePlaylistHighlight();
                startProgressUpdate();
            }).catch(error => {
                console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                document.getElementById('nowPlaying').textContent = '–ù–∞–∂–º–∏ ‚ñ∂ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è';
                document.getElementById('compactTitle').textContent = '–ù–∞–∂–º–∏ ‚ñ∂';
            });
        }

        function togglePlay() {
            if (!audioInitialized) {
                initializeAudio();
            }
            
            if (isPlaying) {
                audio.pause();
                document.getElementById('playBtn').textContent = '‚ñ∂';
                document.getElementById('compactPlayBtn').textContent = '‚ñ∂';
                isPlaying = false;
                stopProgressUpdate();
            } else {
                if (audio.src) {
                    audio.play().then(() => {
                        document.getElementById('playBtn').textContent = '‚è∏';
                        document.getElementById('compactPlayBtn').textContent = '‚è∏';
                        isPlaying = true;
                        startProgressUpdate();
                    }).catch(error => {
                        console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                    });
                } else {
                    loadAndPlayTrack(currentTrack);
                }
            }
        }

        function playTrack(index) {
            if (isPlaying) {
                audio.pause();
            }
            loadAndPlayTrack(index);
            closePlaylist();
            closeCompactPlaylist();
        }

        function nextTrack() {
            playTrack((currentTrack + 1) % tracks.length);
        }

        function previousTrack() {
            playTrack((currentTrack - 1 + tracks.length) % tracks.length);
        }

        function startProgressUpdate() {
            updateInterval = setInterval(() => {
                if (audio.duration && !isSeeking) {
                    const progress = (audio.currentTime / audio.duration) * 100;
                    document.getElementById('musicProgress').style.width = progress + '%';
                    document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
                }
            }, 1000);
        }

        function stopProgressUpdate() {
            clearInterval(updateInterval);
        }

        function setVolume(volume) {
            if (audio) {
                audio.volume = volume / 100;
            }
        }

        function togglePlaylist() {
            const playlist = document.getElementById('playlist');
            playlist.style.display = playlist.style.display === 'block' ? 'none' : 'block';
        }

        function closePlaylist() {
            document.getElementById('playlist').style.display = 'none';
        }

        function toggleCompactPlaylist() {
            const playlist = document.getElementById('compactPlaylist');
            playlist.style.display = playlist.style.display === 'block' ? 'none' : 'block';
        }

        function closeCompactPlaylist() {
            document.getElementById('compactPlaylist').style.display = 'none';
        }

        function updatePlaylistHighlight() {
            const items = document.querySelectorAll('.playlist-item');
            const compactItems = document.querySelectorAll('.compact-playlist-item');
            
            items.forEach((item, index) => {
                if (index === currentTrack) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            compactItems.forEach((item, index) => {
                if (index === currentTrack) {
                    item.style.background = 'rgba(102, 126, 234, 0.2)';
                    item.style.color = '#667eea';
                    item.style.fontWeight = 'bold';
                } else {
                    item.style.background = '';
                    item.style.color = '#333';
                    item.style.fontWeight = 'normal';
                }
            });
        }

        // ==================== –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û–î –†–ê–ó–ù–´–ï –≠–ö–†–ê–ù–´ ====================
        function handleResponsiveLayout() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            if (width <= 1366) {
                document.body.classList.add('small-laptop');
            } else {
                document.body.classList.remove('small-laptop');
            }
            
            if (width <= 1280) {
                document.body.classList.add('very-small-screen');
            } else {
                document.body.classList.remove('very-small-screen');
            }
            
            if (width <= 1200) {
                document.getElementById('musicPlayer').style.display = 'block';
                document.getElementById('compactPlayer').style.display = 'none';
            } else if (width <= 768) {
                document.getElementById('musicPlayer').style.display = 'none';
                document.getElementById('compactPlayer').style.display = 'block';
            } else {
                document.getElementById('musicPlayer').style.display = 'block';
                document.getElementById('compactPlayer').style.display = 'none';
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        async function initializeApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            questions = await loadQuestions();
            console.log('‚úÖ –í–æ–ø—Ä–æ—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', questions);
            
            generateQuestionScreens();
            
            document.getElementById('nowPlaying').textContent = '–ù–∞–∂–º–∏ ‚ñ∂ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è';
            document.getElementById('compactTitle').textContent = '–ù–∞–∂–º–∏ ‚ñ∂';
            document.getElementById('trackInfo').textContent = `1/${tracks.length}`;
            document.getElementById('compactTrack').textContent = `1/${tracks.length}`;
            updatePlaylistHighlight();
            createHearts();
            
            handleResponsiveLayout();
            
            setInterval(checkBotMessages, 3000);
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('progressContainer').addEventListener('click', function(e) {
            if (!audio || !audio.duration) return;
            
            const rect = this.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        });

        if (audio) {
            audio.addEventListener('ended', function() {
                nextTrack();
            });
        }

        document.addEventListener('click', function(event) {
            const playlist = document.getElementById('playlist');
            const player = document.getElementById('musicPlayer');
            const compactPlaylist = document.getElementById('compactPlaylist');
            const compactPlayer = document.getElementById('compactPlayer');
            
            if (player && !player.contains(event.target)) {
                closePlaylist();
            }
            
            if (compactPlayer && !compactPlayer.contains(event.target)) {
                closeCompactPlaylist();
            }
        });

        window.addEventListener('resize', handleResponsiveLayout);
        window.addEventListener('orientationchange', handleResponsiveLayout);

        window.onload = initializeApp;
    </script>
</body>
</html>
